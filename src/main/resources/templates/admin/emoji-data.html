<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¡¨æƒ…æ•°æ® - ç®¡ç†å‘˜ç³»ç»Ÿ</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome -->
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.8/dist/chart.umd.min.js"></script>
    
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .card-hover {
                transition: transform 0.3s ease, box-shadow 0.3s ease;
            }
            .card-hover:hover {
                transform: translateY(-3px);
                box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
            }
            .card-pulse {
                animation: pulse 2s infinite;
            }
            @keyframes pulse {
                0% {
                    box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.4);
                }
                70% {
                    box-shadow: 0 0 0 10px rgba(59, 130, 246, 0);
                }
                100% {
                    box-shadow: 0 0 0 0 rgba(59, 130, 246, 0);
                }
            }
            .emoji-card {
                @apply bg-white rounded-xl shadow-md p-6 transition-all duration-300 card-hover text-center;
            }
            .emoji-card.active {
                @apply ring-2 ring-primary;
            }
            .emoji-value {
                @apply text-5xl font-bold mb-2 transform transition-transform duration-300;
            }
            .emoji-card:hover .emoji-value {
                @apply scale-110;
            }
            .emoji-count {
                @apply text-xl font-medium text-gray-700;
            }
            .emoji-percentage {
                @apply text-sm text-gray-500 mt-1;
            }
            .btn-primary {
                @apply bg-primary hover:bg-accent text-white font-medium py-2 px-4 rounded-lg transition-all duration-300 shadow-md hover:shadow-lg flex items-center justify-center;
            }
            .btn-secondary {
                @apply bg-gray-100 hover:bg-gray-200 text-gray-700 font-medium py-2 px-4 rounded-lg transition-all duration-300 flex items-center justify-center;
            }
            .fade-in {
                animation: fadeIn 0.5s ease-in;
            }
            @keyframes fadeIn {
                from { opacity: 0; transform: translateY(10px); }
                to { opacity: 1; transform: translateY(0); }
            }
            .loading-spinner {
                @apply border-4 border-gray-200 border-t-primary rounded-full w-6 h-6 animate-spin;
            }
            .table-row-hover {
                @apply hover:bg-gray-50 transition-colors duration-150;
            }
            .badge {
                @apply px-2 py-1 rounded-full text-xs font-medium;
            }
            .badge-success {
                @apply bg-green-100 text-green-800;
            }
            .badge-warning {
                @apply bg-yellow-100 text-yellow-800;
            }
            .badge-danger {
                @apply bg-red-100 text-red-800;
            }
        }
    </style>
    
    <!-- Tailwind é…ç½® -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3B82F6', // è“è‰²ä¸»é¢˜
                        secondary: '#60A5FA',
                        accent: '#2563EB',
                        neutral: '#1F2937',
                    },
                    fontFamily: {
                        inter: ['Inter', 'sans-serif'],
                    },
                },
            }
        }
    </script>
</head>
<body class="bg-gray-50 font-inter">
    <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
    <nav class="bg-white shadow-sm">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <div class="flex-shrink-0 flex items-center">
                        <i class="fa fa-shield text-primary text-2xl mr-2"></i>
                        <span class="font-bold text-xl text-neutral">EmojiChecker ç®¡ç†ç³»ç»Ÿ</span>
                    </div>
                    <div class="hidden sm:ml-10 sm:flex sm:space-x-8">
                        <a href="/admin/dashboard" class="inline-flex items-center px-1 pt-1 border-b-2 border-transparent text-sm font-medium text-gray-500 hover:text-gray-700 hover:border-gray-300">
                            <i class="fa fa-dashboard mr-1"></i>ä»ªè¡¨ç›˜
                        </a>
                        <a href="/admin/users" class="inline-flex items-center px-1 pt-1 border-b-2 border-transparent text-sm font-medium text-gray-500 hover:text-gray-700 hover:border-gray-300">
                            <i class="fa fa-users mr-1"></i>ç”¨æˆ·ç®¡ç†
                        </a>
                        <a href="/admin/emoji-data" class="inline-flex items-center px-1 pt-1 border-b-2 border-primary text-sm font-medium text-primary">
                            <i class="fa fa-bar-chart mr-1"></i>è¡¨æƒ…æ•°æ®
                        </a>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="ml-3 relative">
                        <div>
                            <button type="button" class="flex text-sm rounded-full focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-800 focus:ring-white">
                                <img class="h-8 w-8 rounded-full" src="https://picsum.photos/200" alt="ç®¡ç†å‘˜å¤´åƒ">
                            </button>
                        </div>
                        <!-- ä¸‹æ‹‰èœå• -->
                        <div class="origin-top-right absolute right-0 mt-2 w-48 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5 py-1 hidden" id="user-menu">
                            <a href="/change-password" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                <i class="fa fa-lock mr-1"></i>ä¿®æ”¹å¯†ç 
                            </a>
                            <a href="/logout" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                <i class="fa fa-sign-out mr-1"></i>é€€å‡ºç™»å½•
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            <!-- åŠ è½½çŠ¶æ€æŒ‡ç¤ºå™¨ -->
            <div id="loading-indicator" class="hidden mt-4 flex items-center justify-center text-gray-600">
                <div class="loading-spinner mr-2"></div>
                <span>æ­£åœ¨åŠ è½½æ•°æ®...</span>
            </div>
        </div>
        
        <!-- ç§»åŠ¨ç«¯èœå• -->
        <div class="sm:hidden" id="mobile-menu">
            <div class="pt-2 pb-3 space-y-1">
                <a href="/admin/dashboard" class="block pl-3 pr-4 py-2 border-l-4 border-transparent text-base font-medium text-gray-500 hover:bg-gray-50 hover:border-gray-300 hover:text-gray-700">
                    <i class="fa fa-dashboard mr-1"></i>ä»ªè¡¨ç›˜
                </a>
                <a href="/admin/users" class="block pl-3 pr-4 py-2 border-l-4 border-transparent text-base font-medium text-gray-500 hover:bg-gray-50 hover:border-gray-300 hover:text-gray-700">
                    <i class="fa fa-users mr-1"></i>ç”¨æˆ·ç®¡ç†
                </a>
                <a href="/admin/emoji-data" class="bg-primary/10 block pl-3 pr-4 py-2 border-l-4 border-primary text-base font-medium text-primary">
                    <i class="fa fa-bar-chart mr-1"></i>è¡¨æƒ…æ•°æ®
                </a>
            </div>
        </div>
    </nav>

    <!-- ä¸»å†…å®¹åŒº -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- é¡µé¢æ ‡é¢˜ -->
        <div class="mb-8 fade-in">
            <h1 class="text-[clamp(1.5rem,3vw,2.5rem)] font-bold text-neutral mb-2 flex items-center">
                <i class="fa fa-line-chart text-primary mr-3"></i>è¡¨æƒ…æ•°æ®ç»Ÿè®¡
            </h1>
            <p class="text-gray-600">æŸ¥çœ‹ç³»ç»Ÿä¸­è¡¨æƒ…æ•°æ®çš„è¯¦ç»†ç»Ÿè®¡å’Œåˆ†æ</p>
        </div>
        
        <!-- ç­›é€‰æ¡ä»¶ -->
        <div class="bg-white rounded-xl shadow-md p-6 mb-6 fade-in">
            <div class="flex flex-col md:flex-row items-start md:items-center justify-between gap-4">
                <div class="flex flex-wrap items-center gap-4">
                    <div>
                        <label for="date-range" class="text-sm font-medium text-gray-700 block mb-1">æ—¶é—´èŒƒå›´:</label>
                        <select id="date-range" class="border border-gray-300 rounded-md p-2 text-sm focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all duration-300">
                            <option value="today">ä»Šå¤©</option>
                            <option value="yesterday">æ˜¨å¤©</option>
                            <option value="week">æœ¬å‘¨</option>
                            <option value="month">æœ¬æœˆ</option>
                            <option value="all">å…¨éƒ¨</option>
                        </select>
                    </div>
                    <div>
                        <label for="emoji-type" class="text-sm font-medium text-gray-700 block mb-1">è¡¨æƒ…ç±»å‹:</label>
                        <select id="emoji-type" class="border border-gray-300 rounded-md p-2 text-sm focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all duration-300">
                            <option value="all">å…¨éƒ¨è¡¨æƒ…</option>
                            <option value="positive">ç§¯æè¡¨æƒ…</option>
                            <option value="negative">æ¶ˆæè¡¨æƒ…</option>
                        </select>
                    </div>
                    <div id="custom-date-range" class="hidden">
                        <label class="text-sm font-medium text-gray-700 block mb-1">è‡ªå®šä¹‰æ—¥æœŸ:</label>
                        <div class="flex space-x-2">
                            <input type="date" id="start-date" class="border border-gray-300 rounded-md p-2 text-sm focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all duration-300">
                            <input type="date" id="end-date" class="border border-gray-300 rounded-md p-2 text-sm focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all duration-300">
                        </div>
                    </div>
                </div>
                <div class="flex flex-wrap gap-3">
                    <button id="refresh-data" class="btn-primary">
                        <i class="fa fa-refresh mr-2"></i>åˆ·æ–°æ•°æ®
                    </button>
                    <button id="export-csv" class="btn-primary bg-green-600 hover:bg-green-700">
                        <i class="fa fa-download mr-2"></i>å¯¼å‡ºCSV
                    </button>
                    <button id="export-pdf" class="btn-primary bg-red-600 hover:bg-red-700">
                        <i class="fa fa-file-pdf-o mr-2"></i>å¯¼å‡ºPDF
                    </button>
                    <button id="toggle-chart-view" class="btn-secondary">
                        <i class="fa fa-bar-chart mr-2"></i>å›¾è¡¨è§†å›¾
                    </button>
                </div>
            </div>
        </div>
        
        <!-- ç»Ÿè®¡æ¦‚è§ˆ -->
        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-6 mb-8">
            <!-- æ€»è¡¨æƒ…æ•° -->
            <div class="stat-card">
                <div class="stat-icon bg-primary">
                    <i class="fa fa-smile-o"></i>
                </div>
                <div class="stat-title">æ€»è¡¨æƒ…æ•°</div>
                <div class="stat-value" id="total-emoji-count">0</div>
                <div class="stat-change text-green-600">
                    <i class="fa fa-arrow-up mr-1"></i>
                    <span id="emoji-count-change">0%</span> è¾ƒæ˜¨æ—¥
                </div>
            </div>
            
            <!-- æ´»è·ƒç”¨æˆ·æ•° -->
            <div class="stat-card">
                <div class="stat-icon bg-blue-500">
                    <i class="fa fa-users"></i>
                </div>
                <div class="stat-title">æ´»è·ƒç”¨æˆ·</div>
                <div class="stat-value" id="active-users">0</div>
                <div class="stat-change text-green-600">
                    <i class="fa fa-arrow-up mr-1"></i>
                    <span id="active-users-change">0%</span> è¾ƒæ˜¨æ—¥
                </div>
            </div>
            
            <!-- å¹³å‡è¡¨æƒ…æ•° -->
            <div class="stat-card">
                <div class="stat-icon bg-green-500">
                    <i class="fa fa-line-chart"></i>
                </div>
                <div class="stat-title">äººå‡è¡¨æƒ…</div>
                <div class="stat-value" id="avg-emoji-per-user">0</div>
                <div class="stat-change text-green-600">
                    <i class="fa fa-arrow-up mr-1"></i>
                    <span id="avg-emoji-change">0%</span> è¾ƒæ˜¨æ—¥
                </div>
            </div>
            
            <!-- è¡¨æƒ…ç±»å‹æ•° -->
            <div class="stat-card">
                <div class="stat-icon bg-purple-500">
                    <i class="fa fa-th"></i>
                </div>
                <div class="stat-title">è¡¨æƒ…ç§ç±»</div>
                <div class="stat-value" id="emoji-types">0</div>
                <div class="stat-change text-green-600">
                    <i class="fa fa-arrow-up mr-1"></i>
                    <span id="emoji-types-change">0%</span> è¾ƒæ˜¨æ—¥
                </div>
            </div>
        </div>
        
        <!-- è¡¨æƒ…åˆ†å¸ƒå›¾è¡¨ -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
            <!-- ä¸»è¦è¡¨æƒ…ç»Ÿè®¡ -->
            <div class="bg-white rounded-xl shadow-md p-6">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-semibold text-gray-900">ä¸»è¦è¡¨æƒ…åˆ†å¸ƒ</h3>
                    <button class="text-primary hover:text-primary/80 text-sm font-medium">
                        <i class="fa fa-refresh mr-1"></i>åˆ·æ–°
                    </button>
                </div>
                <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-2 gap-4" id="top-emojis">
                    <!-- è¡¨æƒ…å¡ç‰‡å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                    <div class="flex items-center justify-center">
                        <i class="fa fa-spinner fa-spin text-primary text-2xl"></i>
                    </div>
                </div>
            </div>
            
            <!-- è¡¨æƒ…è¶‹åŠ¿å›¾è¡¨ -->
            <div class="bg-white rounded-xl shadow-md p-6">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-semibold text-gray-900">è¡¨æƒ…è¶‹åŠ¿</h3>
                    <div class="flex space-x-2">
                        <button class="px-3 py-1 text-xs font-medium rounded-full bg-primary/10 text-primary">æ—¥</button>
                        <button class="px-3 py-1 text-xs font-medium rounded-full bg-gray-100 text-gray-700">å‘¨</button>
                        <button class="px-3 py-1 text-xs font-medium rounded-full bg-gray-100 text-gray-700">æœˆ</button>
                    </div>
                </div>
                <div class="h-64">
                    <canvas id="emoji-trend-chart"></canvas>
                </div>
            </div>
        </div>
        
        <!-- è¯¦ç»†è¡¨æƒ…æ•°æ®è¡¨æ ¼ -->
        <div class="bg-white rounded-xl shadow-md overflow-hidden">
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">è¡¨æƒ…</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">æ•°é‡</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ç™¾åˆ†æ¯”</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">å¢é•¿è¶‹åŠ¿</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200" id="emoji-data-table">
                        <tr>
                            <td colspan="5" class="px-6 py-10 text-center text-gray-500">
                                <i class="fa fa-spinner fa-spin text-primary text-2xl mb-2"></i>
                                <p>åŠ è½½è¡¨æƒ…æ•°æ®ä¸­...</p>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <!-- åˆ†é¡µ -->
            <div class="px-4 py-3 bg-gray-50 border-t border-gray-200 sm:px-6">
                <div class="flex items-center justify-between">
                    <div class="hidden sm:flex-1 sm:flex sm:items-center sm:justify-between">
                        <div>
                            <p class="text-sm text-gray-700">
                                æ˜¾ç¤º <span id="emoji-range">1 åˆ° 10</span> æ¡ï¼Œå…± <span id="emoji-total">0</span> æ¡ç»“æœ
                            </p>
                        </div>
                        <div>
                            <nav class="relative z-0 inline-flex rounded-md shadow-sm -space-x-px" aria-label="Pagination">
                                <a href="#" class="relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50" id="prev-emoji-page">
                                    <span class="sr-only">ä¸Šä¸€é¡µ</span>
                                    <i class="fa fa-chevron-left h-5 w-5"></i>
                                </a>
                                <a href="#" class="relative inline-flex items-center px-4 py-2 border border-gray-300 bg-primary text-sm font-medium text-white" id="emoji-page-1">
                                    1
                                </a>
                                <a href="#" class="relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50" id="next-emoji-page">
                                    <span class="sr-only">ä¸‹ä¸€é¡µ</span>
                                    <i class="fa fa-chevron-right h-5 w-5"></i>
                                </a>
                            </nav>
                        </div>
                    </div>
                    
                    <!-- ç§»åŠ¨ç«¯åˆ†é¡µ -->
                    <div class="flex items-center sm:hidden">
                        <a href="#" class="relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50">
                            ä¸Šä¸€é¡µ
                        </a>
                        <span class="mx-2 text-gray-700">|</span>
                        <a href="#" class="relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50">
                            ä¸‹ä¸€é¡µ
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // å…¨å±€å˜é‡
            let currentPage = 1;
            const pageSize = 10;
            let totalPages = 1;
            let emojiChart = null;
            let isChartView = false;

            // DOMåŠ è½½å®Œæˆååˆå§‹åŒ–
            document.addEventListener('DOMContentLoaded', function() {
                // åˆå§‹åŒ–é¡µé¢
                initPage();
                
                // åˆå§‹åŒ–äº‹ä»¶ç›‘å¬
                initEventListeners();
            });

            // åˆå§‹åŒ–äº‹ä»¶ç›‘å¬å‡½æ•°
            function initEventListeners() {
                // æ—¥æœŸèŒƒå›´å˜æ›´äº‹ä»¶
                document.getElementById('date-range').addEventListener('change', function() {
                    // æ˜¾ç¤º/éšè—è‡ªå®šä¹‰æ—¥æœŸé€‰æ‹©å™¨
                    const customDateRange = document.getElementById('custom-date-range');
                    if (this.value === 'custom') {
                        customDateRange.classList.remove('hidden');
                    } else {
                        customDateRange.classList.add('hidden');
                    }
                    refreshData();
                });
                
                // è¡¨æƒ…ç±»å‹å˜æ›´äº‹ä»¶
                document.getElementById('emoji-type').addEventListener('change', refreshData);
                
                // åˆ·æ–°æ•°æ®æŒ‰é’®
                document.getElementById('refresh-data').addEventListener('click', refreshData);
                
                // å¯¼å‡ºCSVæŒ‰é’®
                document.getElementById('export-csv').addEventListener('click', exportToCSV);
                
                // å¯¼å‡ºPDFæŒ‰é’®
                document.getElementById('export-pdf').addEventListener('click', exportToPDF);
                
                // å›¾è¡¨è§†å›¾åˆ‡æ¢
                document.getElementById('toggle-chart-view').addEventListener('click', toggleChartView);
                
                // è‡ªå®šä¹‰æ—¥æœŸå˜æ›´äº‹ä»¶
                document.getElementById('start-date').addEventListener('change', refreshData);
                document.getElementById('end-date').addEventListener('change', refreshData);
                
                // ç§»åŠ¨ç«¯èœå•åˆ‡æ¢
                const userMenuButton = document.querySelector('button[class*="focus:ring-2"]');
                if (userMenuButton) {
                    userMenuButton.addEventListener('click', function() {
                        const userMenu = document.getElementById('user-menu');
                        userMenu.classList.toggle('hidden');
                    });
                }
            }
            
            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            function showLoading(elementId) {
                const element = document.getElementById(elementId);
                if (element) {
                    // æ·»åŠ æ·¡å…¥åŠ¨ç”»
                    element.style.opacity = '0';
                    
                    const loadingHTML = '<div class="flex items-center justify-center py-4">' +
                        '<div class="loading-spinner mr-2"></div>' +
                        '<span class="text-primary">åŠ è½½ä¸­...</span>' +
                        '</div>';
                    
                    if (elementId === 'emoji-data-table') {
                        element.innerHTML = `<tr><td colspan="5" class="px-6 py-10 text-center text-gray-500">${loadingHTML}</td></tr>`;
                    } else {
                        element.innerHTML = loadingHTML;
                    }
                    
                    // è§¦å‘é‡æ’åæ·»åŠ æ·¡å…¥æ•ˆæœ
                    setTimeout(() => {
                        element.style.transition = 'opacity 0.3s ease';
                        element.style.opacity = '1';
                    }, 10);
                }
            }
            
            // è·å–ç­›é€‰å‚æ•°
            function getFilterParams() {
                const params = {
                    dateRange: document.getElementById('date-range').value,
                    emojiType: document.getElementById('emoji-type').value
                };
                
                // æ·»åŠ è‡ªå®šä¹‰æ—¥æœŸå‚æ•°
                if (params.dateRange === 'custom') {
                    const startDate = document.getElementById('start-date').value;
                    const endDate = document.getElementById('end-date').value;
                    if (startDate) params.startDate = startDate;
                    if (endDate) params.endDate = endDate;
                }
                
                return params;
            }
            
            // æ„å»ºæŸ¥è¯¢URL
            function buildQueryUrl(baseUrl, params) {
                const queryString = Object.entries(params)
                    .filter(([_, value]) => value && value !== 'all')
                    .map(([key, value]) => `${encodeURIComponent(key)}=${encodeURIComponent(value)}`)
                    .join('&');
                
                return queryString ? `${baseUrl}?${queryString}` : baseUrl;
            }
            
            // æ•°å­—å¢é•¿åŠ¨ç”»
            function animateNumber(element, start, end, duration) {
                let startTime = null;
                
                function step(timestamp) {
                    if (!startTime) startTime = timestamp;
                    const progress = Math.min((timestamp - startTime) / duration, 1);
                    const value = Math.floor(progress * (end - start) + start);
                    element.textContent = value.toLocaleString();
                    
                    if (progress < 1) {
                        window.requestAnimationFrame(step);
                    }
                }
                
                window.requestAnimationFrame(step);
            }
            
            // åŠ è½½ç»Ÿè®¡æ•°æ®
            async function loadStats() {
                try {
                    const params = getFilterParams();
                    const url = buildQueryUrl('/api/admin/emoji-stats', params);
                    
                    const response = await fetch(url);
                    if (!response.ok) throw new Error('ç½‘ç»œå“åº”é”™è¯¯');
                    
                    const data = await response.json();
                    
                    // æ›´æ–°ç»Ÿè®¡å¡ç‰‡ï¼Œæ·»åŠ æ•°å­—åŠ¨ç”»
                    const totalCount = data.totalCount || 0;
                    const activeUsers = data.activeUsers || 0;
                    const avgPerUser = data.averagePerUser || 0;
                    const emojiTypes = data.emojiTypes || 0;
                    
                    animateNumber(document.getElementById('total-emoji-count'), 0, totalCount, 1000);
                    animateNumber(document.getElementById('active-users'), 0, activeUsers, 1000);
                    
                    // å¹³å‡å€¼éœ€è¦ç‰¹æ®Šå¤„ç†
                    const avgElement = document.getElementById('avg-emoji-per-user');
                    let currentAvg = 0;
                    const avgInterval = setInterval(() => {
                        currentAvg += avgPerUser / 30; // åˆ†30æ­¥å®ŒæˆåŠ¨ç”»
                        if (currentAvg >= avgPerUser) {
                            currentAvg = avgPerUser;
                            clearInterval(avgInterval);
                        }
                        avgElement.textContent = currentAvg.toFixed(1);
                    }, 33);
                    
                    animateNumber(document.getElementById('emoji-types'), 0, emojiTypes, 1000);
                    
                    // æ›´æ–°å˜åŒ–ç‡
                    document.getElementById('emoji-count-change').textContent = data.countChange ? `${data.countChange > 0 ? '+' : ''}${data.countChange}%` : '0%';
                    document.getElementById('active-users-change').textContent = data.userChange ? `${data.userChange > 0 ? '+' : ''}${data.userChange}%` : '0%';
                    document.getElementById('avg-emoji-change').textContent = data.avgChange ? `${data.avgChange > 0 ? '+' : ''}${data.avgChange}%` : '0%';
                    document.getElementById('emoji-types-change').textContent = data.typesChange ? `${data.typesChange > 0 ? '+' : ''}${data.typesChange}%` : '0%';
                    
                    // æ›´æ–°å˜åŒ–ç‡é¢œè‰²
                    updateChangeRateColors();
                } catch (error) {
                    console.error('åŠ è½½ç»Ÿè®¡æ•°æ®å¤±è´¥:', error);
                    // åŠ è½½å¤±è´¥æ—¶æ˜¾ç¤ºæ¨¡æ‹Ÿæ•°æ®ï¼Œå¸¦åŠ¨ç”»
                    animateNumber(document.getElementById('total-emoji-count'), 0, 1876, 1000);
                    animateNumber(document.getElementById('active-users'), 0, 212, 1000);
                    
                    const avgElement = document.getElementById('avg-emoji-per-user');
                    let currentAvg = 0;
                    const avgInterval = setInterval(() => {
                        currentAvg += 8.8 / 30;
                        if (currentAvg >= 8.8) {
                            currentAvg = 8.8;
                            clearInterval(avgInterval);
                        }
                        avgElement.textContent = currentAvg.toFixed(1);
                    }, 33);
                    
                    animateNumber(document.getElementById('emoji-types'), 0, 24, 1000);
                }
            }
            
            // æ›´æ–°å˜åŒ–ç‡é¢œè‰²
            function updateChangeRateColors() {
                const changeElements = document.querySelectorAll('.stat-change');
                changeElements.forEach(el => {
                    const text = el.textContent;
                    if (text.includes('-')) {
                        el.classList.remove('text-green-600');
                        el.classList.add('text-red-600');
                    } else {
                        el.classList.remove('text-red-600');
                        el.classList.add('text-green-600');
                    }
                });
            }
            
            // åŠ è½½ä¸»è¦è¡¨æƒ…
            async function loadTopEmojis() {
                try {
                    const params = getFilterParams();
                    const url = buildQueryUrl('/api/admin/emoji-stats/top', params);
                    
                    showLoading('top-emojis');
                    
                    const response = await fetch(url);
                    if (!response.ok) throw new Error('ç½‘ç»œå“åº”é”™è¯¯');
                    
                    const data = await response.json();
                    const topEmojisContainer = document.getElementById('top-emojis');
                    topEmojisContainer.innerHTML = '';
                    
                    if (data && data.length > 0) {
                        // ä¸ºæ¯ä¸ªè¡¨æƒ…å¡ç‰‡æ·»åŠ å»¶è¿Ÿæ˜¾ç¤ºæ•ˆæœ
                        data.forEach((item, index) => {
                            setTimeout(() => {
                                const emojiCard = document.createElement('div');
                                emojiCard.className = 'emoji-card fade-in';
                                emojiCard.innerHTML = `
                                    <div class="emoji-value transform transition-transform hover:scale-125">${item.emoji}</div>
                                    <div class="emoji-count">${item.count}</div>
                                    <div class="emoji-percentage">${item.percentage} çš„æ€»æ•°</div>
                                `;
                                
                                // æ·»åŠ ç‚¹å‡»äº‹ä»¶
                                emojiCard.addEventListener('click', () => {
                                    viewEmojiDetails(item.emoji);
                                });
                                
                                topEmojisContainer.appendChild(emojiCard);
                            }, index * 100); // æ¯ä¸ªå¡ç‰‡å»¶è¿Ÿ100ms
                        });
                    } else {
                        // æ²¡æœ‰æ•°æ®æ—¶æ˜¾ç¤ºæç¤º
                        topEmojisContainer.innerHTML = '<div class="text-center text-gray-500 col-span-full py-4">æš‚æ— æ•°æ®</div>';
                    }
                } catch (error) {
                    console.error('åŠ è½½ä¸»è¦è¡¨æƒ…å¤±è´¥:', error);
                    // åŠ è½½å¤±è´¥æ—¶ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®
                    loadMockTopEmojis();
                }
            }
            
            // åŠ è½½æ¨¡æ‹Ÿä¸»è¦è¡¨æƒ…ï¼ˆå¤‡ç”¨ï¼‰
            function loadMockTopEmojis() {
                const topEmojisContainer = document.getElementById('top-emojis');
                const topEmojis = [
                    { emoji: 'ğŸ˜Š', count: 658, percentage: '35.1%' },
                    { emoji: 'ğŸ‘', count: 469, percentage: '25.0%' },
                    { emoji: 'â¤ï¸', count: 375, percentage: '20.0%' },
                    { emoji: 'ğŸ˜®', count: 188, percentage: '10.0%' },
                    { emoji: 'ğŸ˜¢', count: 94, percentage: '5.0%' },
                    { emoji: 'ğŸ‰', count: 92, percentage: '4.9%' }
                ];
                
                topEmojisContainer.innerHTML = '';
                topEmojis.forEach(item => {
                    const emojiCard = document.createElement('div');
                    emojiCard.className = 'emoji-card';
                    emojiCard.innerHTML = `
                        <div class="emoji-value">${item.emoji}</div>
                        <div class="emoji-count">${item.count}</div>
                        <div class="emoji-percentage">${item.percentage} çš„æ€»æ•°</div>
                    `;
                    topEmojisContainer.appendChild(emojiCard);
                });
            }
            
            // å›¾è¡¨æ•°æ®åŠ è½½åŠ¨ç”»
            function animateChart() {
                if (emojiChart) {
                    // ä¸ºå›¾è¡¨æ·»åŠ åŠ¨ç”»æ•ˆæœ
                    emojiChart.data.datasets.forEach(dataset => {
                        // é‡ç½®ä¸º0
                        const originalData = [...dataset.data];
                        dataset.data = dataset.data.map(() => 0);
                        
                        // åŠ¨ç”»æ›´æ–°åˆ°åŸå§‹æ•°æ®
                        setTimeout(() => {
                            dataset.data = originalData;
                            emojiChart.update('active');
                        }, 100);
                    });
                }
            }
            
            // åˆ‡æ¢å›¾è¡¨è§†å›¾
            function toggleChartView() {
                isChartView = !isChartView;
                const toggleBtn = document.getElementById('chart-view-toggle');
                
                if (isChartView) {
                    toggleBtn.innerHTML = '<i class="fa fa-bar-chart mr-1"></i> æŸ±çŠ¶å›¾';
                } else {
                    toggleBtn.innerHTML = '<i class="fa fa-line-chart mr-1"></i> æŠ˜çº¿å›¾';
                }
                
                // é‡æ–°åˆå§‹åŒ–å›¾è¡¨
                initEmojiTrendChart();
            }
            
            // åˆå§‹åŒ–è¡¨æƒ…è¶‹åŠ¿å›¾è¡¨
            async function initEmojiTrendChart() {
                try {
                    const params = getFilterParams();
                    const url = buildQueryUrl('/api/admin/emoji-stats/trend', params);
                    
                    // æ˜¾ç¤ºå›¾è¡¨åŠ è½½çŠ¶æ€
                    const chartContainer = document.getElementById('emoji-trend-chart').parentElement;
                    chartContainer.classList.add('chart-loading');
                    
                    const response = await fetch(url);
                    if (!response.ok) throw new Error('ç½‘ç»œå“åº”é”™è¯¯');
                    
                    const data = await response.json();
                    const ctx = document.getElementById('emoji-trend-chart').getContext('2d');
                    
                    // é”€æ¯ç°æœ‰å›¾è¡¨
                    if (emojiChart) {
                        emojiChart.destroy();
                    }
                    
                    // åˆ›å»ºæ–°å›¾è¡¨
                    emojiChart = new Chart(ctx, {
                        type: isChartView ? 'line' : 'bar',
                        data: {
                            labels: data.labels || ['1æœˆ', '2æœˆ', '3æœˆ', '4æœˆ', '5æœˆ', '6æœˆ'],
                            datasets: data.datasets || [
                                {
                                    label: 'ğŸ˜Š å¼€å¿ƒ',
                                    data: [350, 420, 380, 450, 520, 658],
                                    backgroundColor: 'rgba(59, 130, 246, 0.8)',
                                    borderColor: 'rgba(59, 130, 246, 1)',
                                    borderWidth: 2,
                                    tension: isChartView ? 0.4 : 0,
                                    fill: isChartView
                                },
                                {
                                    label: 'ğŸ‘ èµåŒ',
                                    data: [250, 320, 280, 350, 400, 469],
                                    backgroundColor: 'rgba(16, 185, 129, 0.8)',
                                    borderColor: 'rgba(16, 185, 129, 1)',
                                    borderWidth: 2,
                                    tension: isChartView ? 0.4 : 0,
                                    fill: isChartView
                                },
                                {
                                    label: 'â¤ï¸ å–œæ¬¢',
                                    data: [200, 250, 220, 280, 320, 375],
                                    backgroundColor: 'rgba(239, 68, 68, 0.8)',
                                    borderColor: 'rgba(239, 68, 68, 1)',
                                    borderWidth: 2,
                                    tension: isChartView ? 0.4 : 0,
                                    fill: isChartView
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            animation: {
                                duration: 1000,
                                easing: 'easeInOutQuart'
                            },
                            interaction: {
                                intersect: false,
                                mode: 'index'
                            },
                            plugins: {
                                tooltip: {
                                    backgroundColor: 'rgba(0, 0, 0, 0.8)',
                                    padding: 12,
                                    titleFont: {
                                        size: 14,
                                        weight: 'bold'
                                    },
                                    bodyFont: {
                                        size: 13
                                    },
                                    callbacks: {
                                        label: function(context) {
                                            return context.dataset.label + ': ' + context.parsed.y.toLocaleString();
                                        }
                                    }
                                },
                                legend: {
                                    position: 'top',
                                    labels: {
                                        usePointStyle: true,
                                        boxWidth: 8,
                                        font: {
                                            size: 12
                                        },
                                        padding: 20
                                    }
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    grid: {
                                        color: 'rgba(0, 0, 0, 0.05)'
                                    },
                                    ticks: {
                                        font: {
                                            size: 12
                                        },
                                        callback: function(value) {
                                            return value >= 1000 ? (value / 1000) + 'k' : value;
                                        }
                                    }
                                },
                                x: {
                                    grid: {
                                        display: false
                                    },
                                    ticks: {
                                        font: {
                                            size: 12
                                        }
                                    }
                                }
                            }
                        }
                    });
                    
                    // ç§»é™¤åŠ è½½çŠ¶æ€
                    chartContainer.classList.remove('chart-loading');
                    
                    // æ·»åŠ å›¾è¡¨åŠ¨ç”»
                    animateChart();
                    
                } catch (error) {
                    console.error('åˆå§‹åŒ–å›¾è¡¨å¤±è´¥:', error);
                    // ä½¿ç”¨é»˜è®¤å›¾è¡¨
                    const ctx = document.getElementById('emoji-trend-chart').getContext('2d');
                    
                    if (emojiChart) {
                        emojiChart.destroy();
                    }
                    
                    emojiChart = new Chart(ctx, {
                        type: isChartView ? 'line' : 'bar',
                        data: {
                            labels: ['1æœˆ', '2æœˆ', '3æœˆ', '4æœˆ', '5æœˆ', '6æœˆ'],
                            datasets: [
                                {
                                    label: 'ğŸ˜Š å¼€å¿ƒ',
                                    data: [350, 420, 380, 450, 520, 658],
                                    backgroundColor: 'rgba(59, 130, 246, 0.8)',
                                    borderColor: 'rgba(59, 130, 246, 1)',
                                    borderWidth: 2,
                                    tension: isChartView ? 0.4 : 0,
                                    fill: isChartView
                                },
                                {
                                    label: 'ğŸ‘ èµåŒ',
                                    data: [250, 320, 280, 350, 400, 469],
                                    backgroundColor: 'rgba(16, 185, 129, 0.8)',
                                    borderColor: 'rgba(16, 185, 129, 1)',
                                    borderWidth: 2,
                                    tension: isChartView ? 0.4 : 0,
                                    fill: isChartView
                                },
                                {
                                    label: 'â¤ï¸ å–œæ¬¢',
                                    data: [200, 250, 220, 280, 320, 375],
                                    backgroundColor: 'rgba(239, 68, 68, 0.8)',
                                    borderColor: 'rgba(239, 68, 68, 1)',
                                    borderWidth: 2,
                                    tension: isChartView ? 0.4 : 0,
                                    fill: isChartView
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            animation: {
                                duration: 1000,
                                easing: 'easeInOutQuart'
                            },
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    grid: {
                                        color: 'rgba(0, 0, 0, 0.05)'
                                    }
                                },
                                x: {
                                    grid: {
                                        display: false
                                    }
                                }
                            }
                        }
                    });
                }
            }
            
            // æ·»åŠ è¡¨æ ¼è¡ŒåŠ¨ç”»æ•ˆæœ
            function animateTableRows() {
                const rows = document.querySelectorAll('#emoji-data-table tr');
                rows.forEach((row, index) => {
                    // è®¾ç½®åˆå§‹çŠ¶æ€
                    row.style.opacity = '0';
                    row.style.transform = 'translateY(10px)';
                    row.style.transition = 'opacity 0.3s ease, transform 0.3s ease';
                    
                    // å»¶è¿ŸåŠ¨ç”»æ•ˆæœï¼Œåˆ›å»ºçº§è”æ•ˆæœ
                    setTimeout(() => {
                        row.style.opacity = '1';
                        row.style.transform = 'translateY(0)';
                    }, 50 * index);
                });
            }
            
            // åŠ è½½è¡¨æƒ…æ•°æ®è¡¨æ ¼
            async function loadEmojiDataTable(page = 1) {
                try {
                    const params = {
                        ...getFilterParams(),
                        page: page,
                        size: 10
                    };
                    const url = buildQueryUrl('/api/admin/emoji-stats/list', params);
                    
                    showLoading('emoji-data-table');
                    
                    const response = await fetch(url);
                    if (!response.ok) throw new Error('ç½‘ç»œå“åº”é”™è¯¯');
                    
                    const data = await response.json();
                    const tableBody = document.getElementById('emoji-data-table');
                    tableBody.innerHTML = '';
                    
                    if (data.content && data.content.length > 0) {
                        // æ›´æ–°åˆ†é¡µä¿¡æ¯
                        currentPage = data.page || 1;
                        totalPages = data.totalPages || 1;
                        const totalElements = data.totalElements || 0;
                        const startItem = (currentPage - 1) * 10 + 1;
                        const endItem = Math.min(startItem + 9, totalElements);
                        
                        document.getElementById('emoji-range').textContent = `${startItem} åˆ° ${endItem}`;
                        document.getElementById('emoji-total').textContent = totalElements;
                        
                        // æ›´æ–°è¡¨æ ¼æ•°æ®
                        data.content.forEach((item, index) => {
                            const row = document.createElement('tr');
                            row.className = index % 2 === 0 ? 'bg-white' : 'bg-gray-50';
                            // æ·»åŠ é¼ æ ‡æ‚¬åœæ•ˆæœ
                            row.className += ' transition-all duration-200 hover:bg-gray-100 cursor-pointer';
                            
                            const trend = item.trend || '+0%';
                            const trendClass = trend.startsWith('+') ? 'text-green-600' : 'text-red-600';
                            const trendIcon = trend.startsWith('+') ? 'fa-arrow-up' : 'fa-arrow-down';
                            
                            // ç™¾åˆ†æ¯”æ•°å€¼æå–ï¼ˆç”¨äºè¿›åº¦æ¡åŠ¨ç”»ï¼‰
                            const percentageValue = parseFloat(item.percentage) || 0;
                            
                            row.innerHTML = `
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <div class="flex items-center">
                                        <div class="text-3xl mr-3">${item.emoji}</div>
                                    </div>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <div class="text-sm font-medium text-gray-900">${item.count}</div>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <div class="flex items-center">
                                        <div class="w-20 bg-gray-200 rounded-full h-2.5 mr-2">
                                            <div class="bg-primary h-2.5 rounded-full progress-bar" data-width="${percentageValue}%"></div>
                                        </div>
                                        <span class="text-sm font-medium text-gray-700">${item.percentage}</span>
                                    </div>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${trendClass}">
                                        <i class="fa ${trendIcon} mr-1"></i>${trend}
                                    </span>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                    <button class="text-primary hover:text-primary/80 mr-3 transition-colors" onclick="viewEmojiDetails('${item.emoji}')"><i class="fa fa-search mr-1"></i>è¯¦æƒ…</button>
                                    <button class="text-blue-500 hover:text-blue-700 transition-colors" onclick="exportEmojiData('${item.emoji}')"><i class="fa fa-download mr-1"></i>å¯¼å‡º</button>
                                </td>
                            `;
                            
                            // æ·»åŠ ç‚¹å‡»äº‹ä»¶ï¼Œæ•´è¡Œå¯ç‚¹å‡»æŸ¥çœ‹è¯¦æƒ…
                            row.addEventListener('click', function(e) {
                                // å¦‚æœç‚¹å‡»çš„æ˜¯æŒ‰é’®ï¼Œä¸è§¦å‘è¡Œç‚¹å‡»äº‹ä»¶
                                if (!e.target.closest('button')) {
                                    viewEmojiDetails(item.emoji);
                                }
                            });
                            
                            tableBody.appendChild(row);
                        });
                        
                        // æ·»åŠ è¿›åº¦æ¡åŠ¨ç”»
                        setTimeout(() => {
                            const progressBars = document.querySelectorAll('.progress-bar');
                            progressBars.forEach(bar => {
                                bar.style.width = bar.dataset.width;
                                bar.style.transition = 'width 1s ease-in-out';
                            });
                        }, 100);
                        
                        // æ·»åŠ è¡¨æ ¼è¡ŒåŠ¨ç”»
                        animateTableRows();
                    } else {
                        // æ²¡æœ‰æ•°æ®æ—¶æ˜¾ç¤ºæç¤º
                        tableBody.innerHTML = `<tr><td colspan="5" class="px-6 py-10 text-center text-gray-500">æš‚æ— è¡¨æƒ…æ•°æ®</td></tr>`;
                        document.getElementById('emoji-range').textContent = '0 åˆ° 0';
                        document.getElementById('emoji-total').textContent = '0';
                    }
                    
                    // æ›´æ–°åˆ†é¡µæŒ‰é’®çŠ¶æ€
                    updatePaginationButtons();
                } catch (error) {
                    console.error('åŠ è½½è¡¨æ ¼æ•°æ®å¤±è´¥:', error);
                    loadMockEmojiDataTable();
                }
            }
            
            // åŠ è½½æ¨¡æ‹Ÿè¡¨æ ¼æ•°æ®ï¼ˆå¤‡ç”¨ï¼‰
            function loadMockEmojiDataTable() {
                const emojiData = [
                    { emoji: 'ğŸ˜Š', count: 658, percentage: '35.1%', trend: '+15%' },
                    { emoji: 'ğŸ‘', count: 469, percentage: '25.0%', trend: '+8%' },
                    { emoji: 'â¤ï¸', count: 375, percentage: '20.0%', trend: '+12%' },
                    { emoji: 'ğŸ˜®', count: 188, percentage: '10.0%', trend: '-3%' },
                    { emoji: 'ğŸ˜¢', count: 94, percentage: '5.0%', trend: '+2%' },
                    { emoji: 'ğŸ‰', count: 92, percentage: '4.9%', trend: '+18%' },
                    { emoji: 'ğŸ‘', count: 85, percentage: '4.5%', trend: '+7%' },
                    { emoji: 'ğŸ™', count: 78, percentage: '4.2%', trend: '+5%' },
                    { emoji: 'ğŸ”¥', count: 65, percentage: '3.5%', trend: '+22%' },
                    { emoji: 'ğŸ˜', count: 42, percentage: '2.2%', trend: '+9%' }
                ];
                
                const tableBody = document.getElementById('emoji-data-table');
                tableBody.innerHTML = '';
                
                emojiData.forEach((item, index) => {
                    const row = document.createElement('tr');
                    row.className = index % 2 === 0 ? 'bg-white' : 'bg-gray-50';
                    
                    const trendClass = item.trend.startsWith('+') ? 'text-green-600' : 'text-red-600';
                    const trendIcon = item.trend.startsWith('+') ? 'fa-arrow-up' : 'fa-arrow-down';
                    
                    row.innerHTML = `
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="flex items-center">
                                <div class="text-3xl mr-3">${item.emoji}</div>
                            </div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="text-sm font-medium text-gray-900">${item.count}</div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="flex items-center">
                                <div class="w-20 bg-gray-200 rounded-full h-2.5 mr-2">
                                    <div class="bg-primary h-2.5 rounded-full" style="width: ${item.percentage}"></div>
                                </div>
                                <span class="text-sm font-medium text-gray-700">${item.percentage}</span>
                            </div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${trendClass}">
                                <i class="fa ${trendIcon} mr-1"></i>${item.trend}
                            </span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                            <button class="text-primary hover:text-primary/80 mr-3"><i class="fa fa-search mr-1"></i>è¯¦æƒ…</button>
                            <button class="text-blue-500 hover:text-blue-700"><i class="fa fa-download mr-1"></i>å¯¼å‡º</button>
                        </td>
                    `;
                    
                    tableBody.appendChild(row);
                });
                
                // æ›´æ–°åˆ†é¡µä¿¡æ¯
                document.getElementById('emoji-range').textContent = '1 åˆ° 10';
                document.getElementById('emoji-total').textContent = emojiData.length;
            }
            
            // æ˜¾ç¤ºé€šçŸ¥æç¤º
            function showNotification(message, type = 'info') {
                // åˆ›å»ºé€šçŸ¥å…ƒç´ 
                const notification = document.createElement('div');
                
                // è®¾ç½®åŸºç¡€æ ·å¼å’ŒåŠ¨ç”»
                notification.className = 'fixed top-4 right-4 px-6 py-3 rounded-lg shadow-lg transform transition-all duration-500 opacity-0 translate-y-[-20px] z-50';
                
                // æ ¹æ®ç±»å‹è®¾ç½®ä¸åŒæ ·å¼
                if (type === 'success') {
                    notification.classList.add('bg-green-500', 'text-white');
                    notification.innerHTML = `<i class="fa fa-check-circle mr-2"></i>${message}`;
                } else if (type === 'error') {
                    notification.classList.add('bg-red-500', 'text-white');
                    notification.innerHTML = `<i class="fa fa-exclamation-circle mr-2"></i>${message}`;
                } else {
                    notification.classList.add('bg-blue-500', 'text-white');
                    notification.innerHTML = `<i class="fa fa-info-circle mr-2"></i>${message}`;
                }
                
                // æ·»åŠ åˆ°é¡µé¢
                document.body.appendChild(notification);
                
                // æ˜¾ç¤ºåŠ¨ç”»
                setTimeout(() => {
                    notification.classList.remove('opacity-0', 'translate-y-[-20px]');
                }, 10);
                
                // è®¾ç½®è‡ªåŠ¨æ¶ˆå¤±
                setTimeout(() => {
                    notification.classList.add('opacity-0', 'translate-y-[-20px]');
                    setTimeout(() => {
                        document.body.removeChild(notification);
                    }, 500);
                }, 3000);
            }
            
            // æ›´æ–°åˆ†é¡µæŒ‰é’®
            function updatePaginationButtons() {
                const prevButton = document.getElementById('prev-emoji-page');
                const nextButton = document.getElementById('next-emoji-page');
                
                // æ›´æ–°ä¸Šä¸€é¡µæŒ‰é’®
                if (currentPage <= 1) {
                    prevButton.classList.add('opacity-50', 'cursor-not-allowed');
                    prevButton.removeAttribute('onclick');
                } else {
                    prevButton.classList.remove('opacity-50', 'cursor-not-allowed');
                    prevButton.setAttribute('onclick', `loadEmojiDataTable(${currentPage - 1})`);
                    // æ·»åŠ ç‚¹å‡»åé¦ˆæ•ˆæœ
                    prevButton.addEventListener('click', function() {
                        this.classList.add('scale-95');
                        setTimeout(() => {
                            this.classList.remove('scale-95');
                        }, 150);
                    }, {once: true});
                }
                
                // æ›´æ–°ä¸‹ä¸€é¡µæŒ‰é’®
                if (currentPage >= totalPages) {
                    nextButton.classList.add('opacity-50', 'cursor-not-allowed');
                    nextButton.removeAttribute('onclick');
                } else {
                    nextButton.classList.remove('opacity-50', 'cursor-not-allowed');
                    nextButton.setAttribute('onclick', `loadEmojiDataTable(${currentPage + 1})`);
                    // æ·»åŠ ç‚¹å‡»åé¦ˆæ•ˆæœ
                    nextButton.addEventListener('click', function() {
                        this.classList.add('scale-95');
                        setTimeout(() => {
                            this.classList.remove('scale-95');
                        }, 150);
                    }, {once: true});
                }
            }
            
            // å¯¼å‡ºCSVåŠŸèƒ½
            document.getElementById('export-csv').addEventListener('click', async function() {
                try {
                    // æ·»åŠ åŠ è½½çŠ¶æ€å’Œåé¦ˆæ•ˆæœ
                    const button = this;
                    const originalText = button.innerHTML;
                    button.innerHTML = '<i class="fa fa-spinner fa-spin mr-2"></i>å¯¼å‡ºä¸­...';
                    button.disabled = true;
                    
                    const params = getFilterParams();
                    const url = buildQueryUrl('/api/admin/export/csv', params);
                    
                    // åˆ›å»ºä¸‹è½½é“¾æ¥
                    const link = document.createElement('a');
                    link.href = url;
                    link.download = `emoji-data-${new Date().toISOString().split('T')[0]}.csv`;
                    document.body.appendChild(link);
                    link.click();
                    
                    // æ˜¾ç¤ºæˆåŠŸé€šçŸ¥
                    showNotification('CSVæ–‡ä»¶å¯¼å‡ºæˆåŠŸ', 'success');
                    
                    // æ¢å¤æŒ‰é’®çŠ¶æ€
                    setTimeout(() => {
                        button.innerHTML = originalText;
                        button.disabled = false;
                        document.body.removeChild(link);
                    }, 500);
                } catch (error) {
                    console.error('å¯¼å‡ºCSVå¤±è´¥:', error);
                    showNotification('å¯¼å‡ºCSVå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•', 'error');
                }
            });
            
            // å¯¼å‡ºPDFåŠŸèƒ½
            document.getElementById('export-pdf').addEventListener('click', async function() {
                try {
                    // æ·»åŠ åŠ è½½çŠ¶æ€å’Œåé¦ˆæ•ˆæœ
                    const button = this;
                    const originalText = button.innerHTML;
                    button.innerHTML = '<i class="fa fa-spinner fa-spin mr-2"></i>å¯¼å‡ºä¸­...';
                    button.disabled = true;
                    
                    const params = getFilterParams();
                    const url = buildQueryUrl('/api/admin/export/pdf', params);
                    
                    // åˆ›å»ºä¸‹è½½é“¾æ¥
                    const link = document.createElement('a');
                    link.href = url;
                    link.download = `emoji-data-${new Date().toISOString().split('T')[0]}.pdf`;
                    document.body.appendChild(link);
                    link.click();
                    
                    // æ˜¾ç¤ºæˆåŠŸé€šçŸ¥
                    showNotification('PDFæ–‡ä»¶å¯¼å‡ºæˆåŠŸ', 'success');
                    
                    // æ¢å¤æŒ‰é’®çŠ¶æ€
                    setTimeout(() => {
                        button.innerHTML = originalText;
                        button.disabled = false;
                        document.body.removeChild(link);
                    }, 500);
                } catch (error) {
                    console.error('å¯¼å‡ºPDFå¤±è´¥:', error);
                    showNotification('å¯¼å‡ºPDFå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•', 'error');
                }
            });
            
            // ç­›é€‰æ¡ä»¶å˜åŒ–äº‹ä»¶
            document.getElementById('date-range').addEventListener('change', function() {
                // é‡æ–°åŠ è½½æ•°æ®
                loadStats();
                loadTopEmojis();
                loadEmojiDataTable(1); // é‡ç½®åˆ°ç¬¬ä¸€é¡µ
                initEmojiTrendChart();
            });
            
            document.getElementById('emoji-type').addEventListener('change', function() {
                // é‡æ–°åŠ è½½æ•°æ®
                loadStats();
                loadTopEmojis();
                loadEmojiDataTable(1); // é‡ç½®åˆ°ç¬¬ä¸€é¡µ
                initEmojiTrendChart();
            });
            
            // æ·»åŠ å…¨å±€å‡½æ•°ä¾›è¡¨æ ¼ä½¿ç”¨
            window.viewEmojiDetails = function(emoji) {
                // æ˜¾ç¤ºè¯¦æƒ…é€šçŸ¥ä»£æ›¿alertï¼Œæä¾›æ›´å¥½çš„ç”¨æˆ·ä½“éªŒ
                showNotification(`æŸ¥çœ‹è¡¨æƒ… ${emoji} çš„è¯¦ç»†ä¿¡æ¯`);
                // è¿™é‡Œå¯ä»¥æ‰©å±•ä¸ºæ‰“å¼€è¯¦æƒ…æ¨¡æ€æ¡†
            };
            
            window.exportEmojiData = function(emoji) {
                // æ˜¾ç¤ºå¯¼å‡ºé€šçŸ¥ä»£æ›¿alertï¼Œæä¾›æ›´å¥½çš„ç”¨æˆ·ä½“éªŒ
                showNotification(`å¼€å§‹å¯¼å‡ºè¡¨æƒ… ${emoji} çš„æ•°æ®`);
                // è¿™é‡Œå¯ä»¥å®ç°é’ˆå¯¹ç‰¹å®šè¡¨æƒ…çš„å¯¼å‡ºåŠŸèƒ½
            };
            
            // åˆå§‹åŒ–é¡µé¢ï¼Œä½¿ç”¨Promise.allä¼˜åŒ–åŠ è½½é¡ºåº
            async function initPage() {
                try {
                    // æ˜¾ç¤ºé¡µé¢åŠ è½½æç¤º
                    showNotification('æ•°æ®åŠ è½½ä¸­ï¼Œè¯·ç¨å€™...');
                    
                    // å¹¶è¡ŒåŠ è½½æ‰€æœ‰æ•°æ®ï¼Œæé«˜é¡µé¢åŠ è½½é€Ÿåº¦
                    await Promise.all([
                        loadStats(),
                        loadTopEmojis(),
                        loadEmojiDataTable()
                    ]);
                    
                    // å›¾è¡¨åˆå§‹åŒ–å¯ä»¥åœ¨æ•°æ®åŠ è½½å®Œæˆåè¿›è¡Œ
                    await initEmojiTrendChart();
                    
                    // æ˜¾ç¤ºåŠ è½½å®Œæˆé€šçŸ¥
                    showNotification('æ•°æ®åŠ è½½å®Œæˆ', 'success');
                } catch (error) {
                    console.error('é¡µé¢åˆå§‹åŒ–å¤±è´¥:', error);
                    showNotification('éƒ¨åˆ†æ•°æ®åŠ è½½å¤±è´¥ï¼Œæ˜¾ç¤ºå¤‡ç”¨æ•°æ®', 'error');
                }
            }
            
            // è°ƒç”¨åˆå§‹åŒ–å‡½æ•°
            initPage();
        });
    </script>
</body>
</html>